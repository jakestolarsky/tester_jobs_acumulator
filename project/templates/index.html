<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêû Tester jobs acumulator</title>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">
    <!-- Dodatkowe style -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-black {
            font-weight: 800;
        }
    </style>
</head>
<body class="bg-orange-100 p-8 flex flex-col items-center justify-center min-h-screen">

<h1 x-data="{title: 'üêû TESTER JOBS ACUMULATOR'}" x-text="title" class="text-stone-800 text-3xl font-black"></h1>

<div x-data="jobFetcher()" class="relative overflow-x-auto">
    <button @click="scrapeJobs()"
            :disabled="scrapingInProgress"
            class="text-stone-800 hover:orange-100 border-2 border-stone-800 hover:bg-stone-800 focus:ring-4 focus:outline-none focus:ring-gray-300 font-black rounded-lg text-sm px-5 py-2.5 text-center me-2 mb-2 dark:border-stone-800 dark:text-stone-800 dark:hover:text-orange-100 dark:hover:bg-stone-600 dark:focus:ring-stone-800">
        <span x-show="!scrapingInProgress">GIVE ME JOBS!</span>
        <span x-show="scrapingInProgress"><p class="text-sm animate-spin w-5">üêû</p></span>
    </button>

    <div x-show="jobs.length > 0" class="relative overflow-x-auto shadow-md sm:rounded-lg">
        
        <table class="min-w-full text-xs text-left rtl:text-right text-orange-100 dark:text-stone-800">
            <thead class="text-xs text-orange-100 uppercase bg-stone-800 dark:bg-orange-100 dark:text-stone-800">
                <tr>
                    <th scope="col" class="px-6 py-3 font-semibold truncate max-w-xs">DATE</th>
                    <th scope="col" class="px-6 py-3 font-semibold truncate max-w-xs">WEBSITE</th>
                    <th scope="col" class="px-6 py-3 font-semibold truncate max-w-xs">TITLE</th>
                    <th scope="col" class="px-6 py-3 font-semibold truncate max-w-xs">COMPANY</th>
                    <th scope="col" class="px-6 py-3 font-semibold truncate max-w-xs">CITY</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(job, index) in jobs" :key="index">
                    <tr class="bg-orange-100 border-b dark:bg-orange-100 dark:border-gray-700 hover:bg-orange-100 dark:hover:bg-stone-800 dark:text-stone-800 dark:hover:text-orange-100">
                        <th scope="row" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.date">2024/04/04</th>
                        <td class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.website">justjoinit</td>
                        <td class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.title"><a :href="job.link" x-text="job.title"></a></td>
                        <td x-text="job.company" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.company"></td>
                        <td x-text="job.city" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.city"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('jobFetcher', () => ({
            scrapingInProgress: false,
            jobs: [],
            
            scrapeJobs() {
                this.scrapingInProgress = true;
                fetch('/scrape/')
                    .then(response => response.json())
                    .then(data => {
                        this.jobs = data.map(job => ({
                            title: job.job_title,
                            company: job.company,
                            city: job.city,
                            link: job.link_offer
                        }));
                        this.scrapingInProgress = false;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.scrapingInProgress = false;
                    });
            }
        }));
    });
    </script>
    

</body>
</html>
