<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêû Tester jobs acumulator</title>

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap');

        body {
            font-family: 'Montserrat', sans-serif;
        }

        .font-semibold {
            font-weight: 600;
        }

        .font-black {
            font-weight: 800;
        }

        .hover-svg:hover .download-icon path {
            stroke: #ffedd5;
        }

        .download-arrow {
            transition: transform 0.2s linear;
        }

        button:hover .download-arrow {
            transform: translate(0, 3px);
        }
    </style>

</head>

<body class="bg-orange-100 p-8 flex flex-col items-center justify-center min-h-screen">

<h1 x-data="{title: 'üêû TESTER JOBS ACUMULATOR'}" x-text="title" class="text-stone-800 text-3xl font-black mb-5"></h1>

<div x-data="jobFetcher()" class="relative overflow-x-auto">
    <div class="flex items-center justify-between space-x-2">
        <button @click="scrapeJobs()"
                :disabled="scrapingInProgress"
                class="text-stone-800 hover:orange-100 border-2 border-stone-800 hover:bg-stone-800 focus:ring-2 focus:outline-none focus:ring-gray-300 font-black rounded-lg text-sm px-5 py-3 h-12 text-center me-2 mb-2 dark:border-stone-800 dark:text-stone-800 dark:hover:text-orange-100 dark:hover:bg-stone-600 dark:focus:ring-stone-800">
            <span x-show="!scrapingInProgress">GIVE ME JOBS!</span>
            <span x-show="scrapingInProgress"><p class="text-sm animate-spin w-5">üêû</p></span>
        </button>

        <button @click="downloadFile('download_offers/json')"
                class="hover-svg text-stone-800 hover:orange-100 border-2 border-stone-800 hover:bg-stone-800 focus:ring-2 focus:outline-none focus:ring-gray-300 rounded-lg px-4 py-2.5 h-12 text-center me-2 mb-2 dark:border-stone-800 dark:text-stone-800 dark:hover:text-orange-100 dark:hover:bg-stone-600 dark:focus:ring-stone-800">
            <svg class="download-icon" width="15" height="22" viewBox="0 0 18 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path class="download-arrow" d="M13 9L9 13M9 13L5 9M9 13V1" stroke="#292524" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M1 17V18C1 18.7956 1.31607 19.5587 1.87868 20.1213C2.44129 20.6839 3.20435 21 4 21H14C14.7956 21 15.5587 20.6839 16.1213 20.1213C16.6839 19.5587 17 18.7956 17 18V17" stroke="#292524" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
        </button>
    </div>


    <div x-show="jobs.length > 0" class="relative overflow-x-auto shadow-md sm:rounded-lg">

        <table class="min-w-full text-xs text-left rtl:text-right text-orange-100 dark:text-stone-800">
            <thead class="text-xs text-orange-100 uppercase bg-stone-800 dark:bg-orange-100 dark:text-stone-800">
                <tr class="border-b dark:border-stone-800">
                    <th scope="col" class="px-6 py-3 font-black truncate max-w-xs">DATE</th>
                    <th scope="col" class="px-6 py-3 font-black truncate max-w-xs">WEBSITE</th>
                    <th scope="col" class="px-6 py-3 font-black truncate max-w-xs">TITLE</th>
                    <th scope="col" class="px-6 py-3 font-black truncate max-w-xs">COMPANY</th>
                    <th scope="col" class="px-6 py-3 font-black truncate max-w-xs">CITY</th>
                </tr>
            </thead>
            <tbody>
                <template x-for="(job, index) in jobs" :key="index">
                    <tr class="bg-orange-100 border-b dark:bg-orange-100 dark:border-stone-400 hover:bg-orange-100 dark:hover:bg-stone-800 dark:text-stone-800 dark:hover:text-orange-100">
                        <th x-text="job.date" scope="row" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.date"></th>
                        <td x-text="job.website" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.website"></td>
                        <td class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.title"><a :href="job.link" x-text="job.title"></a></td>
                        <td x-text="job.company" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.company"></td>
                        <td x-text="job.city" class="px-6 py-4 font-semibold truncate max-w-xs" :title="job.city"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>

</div>

<script>
    document.addEventListener('alpine:init', () => {
        Alpine.data('jobFetcher', () => ({
            scrapingInProgress: false,
            jobs: [],

            scrapeJobs() {
                this.scrapingInProgress = true;
                fetch('/scrape/')
                    .then(response => response.json())
                    .then(data => {
                        this.jobs = data.map(job => ({
                            date: job.date,
                            website: job.website,
                            title: job.job_title,
                            company: job.company,
                            city: job.city,
                            link: job.link_offer
                        }));
                        this.scrapingInProgress = false;
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        this.scrapingInProgress = false;
                    });
            },

            downloadFile(url) {
            window.location.href = url;
            }
        }));
    });
</script>

</body>
</html>
